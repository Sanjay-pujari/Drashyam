<div class="video-record-upload-container">
  <mat-card class="main-card">
    <mat-card-header>
      <mat-card-title>Create Video</mat-card-title>
      <mat-card-subtitle>Record a new video or upload an existing one</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <mat-tab-group 
        [selectedIndex]="selectedTabIndex" 
        (selectedTabChange)="onTabChange($event.index)"
        class="video-tabs">
        
        <!-- Record Tab -->
        <mat-tab label="Record Video">
          <div class="tab-content">
            <app-video-recorder
              (recordingComplete)="onRecordingComplete($event)"
              (recordingCanceled)="onRecordingCanceled()">
            </app-video-recorder>
          </div>
        </mat-tab>

        <!-- Upload Tab -->
        <mat-tab label="Upload Video">
          <div class="tab-content">
            @if (recordedVideoBlob) {
              <div class="recording-success">
                <mat-icon class="success-icon">check_circle</mat-icon>
                <h3>Video Recorded Successfully!</h3>
                <p>Your recorded video is ready for upload. Add details below.</p>
                <button mat-stroked-button color="primary" (click)="resetRecording()">
                  <mat-icon>refresh</mat-icon>
                  Record Another Video
                </button>
              </div>
            }
            
            <app-video-upload #videoUpload></app-video-upload>
          </div>
        </mat-tab>
      </mat-tab-group>

      <!-- Quota Status Display -->
      <div class="quota-status-section" *ngIf="quotaStatus">
        <h3>Upload Quota Status</h3>
        <div class="quota-cards">
          <!-- Storage Quota -->
          <div class="quota-card">
            <div class="quota-header">
              <mat-icon>storage</mat-icon>
              <span>Storage</span>
            </div>
            <div class="quota-content">
              <div class="quota-stats">
                <span class="used">{{ formatBytes(quotaStatus.storageUsed) }}</span>
                <span class="separator">/</span>
                <span class="limit">{{ formatBytes(quotaStatus.storageLimit) }}</span>
              </div>
              <mat-progress-bar 
                [value]="quotaStatus.storageUsagePercentage"
                [color]="getUsageColor(quotaStatus.storageUsagePercentage)">
              </mat-progress-bar>
              <div class="quota-percentage">
                {{ quotaStatus.storageUsagePercentage | number:'1.1-1' }}% used
              </div>
            </div>
          </div>

          <!-- Video Count Quota -->
          <div class="quota-card">
            <div class="quota-header">
              <mat-icon>video_library</mat-icon>
              <span>Videos</span>
            </div>
            <div class="quota-content">
              <div class="quota-stats">
                <span class="used">{{ quotaStatus.videosUploaded }}</span>
                <span class="separator">/</span>
                <span class="limit">{{ quotaStatus.videoLimit }}</span>
              </div>
              <mat-progress-bar 
                [value]="quotaStatus.videoUsagePercentage"
                [color]="getUsageColor(quotaStatus.videoUsagePercentage)">
              </mat-progress-bar>
              <div class="quota-percentage">
                {{ quotaStatus.videoUsagePercentage | number:'1.1-1' }}% used
              </div>
            </div>
          </div>
        </div>

        <!-- Quota Warning -->
        @if (quotaWarning) {
          <div class="quota-warning">
            <mat-icon color="warn">warning</mat-icon>
            <div class="warning-content">
              <p><strong>Upload quota exceeded!</strong></p>
              <p>You've reached your upload limit. Please upgrade your plan to upload more videos.</p>
              <button mat-stroked-button color="primary" (click)="navigateToQuota()">
                <mat-icon>upgrade</mat-icon>
                Upgrade Plan
              </button>
            </div>
          </div>
        }
      </div>
    </mat-card-content>
  </mat-card>
</div>
