<mat-toolbar color="primary">
  <!-- Sidebar Toggle Button (only show when authenticated) -->
  @if (isAuthenticated$ | async) {
    <button mat-icon-button (click)="toggleSidebar()" class="sidebar-toggle">
      <mat-icon>{{ (isSidebarCollapsed$ | async) ? 'menu' : 'menu_open' }}</mat-icon>
    </button>
  }
  
  <span>{{ title }}</span>
  <span class="spacer"></span>
  
  <!-- Theme Toggle -->
  <app-theme-toggle></app-theme-toggle>
  
  <!-- Navigation Links -->
  <button mat-button routerLink="/">Home</button>
  
  @if (isAuthenticated$ | async) {
    <button mat-button routerLink="/videos">Videos</button>
    <button mat-button routerLink="/my-channels">My Channels</button>
  }
  
  <!-- Authenticated User Menu -->
  @if (isAuthenticated$ | async) {
    <button mat-button routerLink="/favorites">Favorites</button>
    <button mat-button routerLink="/upload">Upload</button>
    
    <!-- Notification Icon -->
    <button mat-icon-button [matMenuTriggerFor]="notificationMenu" class="notification-button" (menuOpened)="loadNotifications()">
      <mat-icon>notifications</mat-icon>
      <span class="notification-badge" *ngIf="(unreadCount$ | async)! > 0">
        {{ unreadCount$ | async }}
      </span>
    </button>
    
    <button mat-icon-button [matMenuTriggerFor]="userMenu">
      <mat-icon>account_circle</mat-icon>
    </button>
    
    <mat-menu #userMenu="matMenu">
      <div class="user-info">
        @if (currentUser$ | async; as user) {
          <div class="user-welcome">
            <p class="welcome-text">Welcome, {{ user.firstName }}!</p>
            <p class="user-email">{{ user.email }}</p>
          </div>
        }
      </div>
      <mat-divider></mat-divider>
      <button mat-menu-item routerLink="/profile">
        <mat-icon>person</mat-icon>
        <span>Profile</span>
      </button>
      <button mat-menu-item routerLink="/channel/create">
        <mat-icon>add_circle</mat-icon>
        <span>Create Channel</span>
      </button>
      <button mat-menu-item routerLink="/invites">
        <mat-icon>mail</mat-icon>
        <span>Invite Friends</span>
      </button>
      <button mat-menu-item routerLink="/referrals">
        <mat-icon>people</mat-icon>
        <span>Referrals</span>
      </button>
      <button mat-menu-item routerLink="/settings">
        <mat-icon>settings</mat-icon>
        <span>Settings</span>
      </button>
      <mat-divider></mat-divider>
      <button mat-menu-item (click)="logout()">
        <mat-icon>logout</mat-icon>
        <span>Logout</span>
      </button>
    </mat-menu>
    
    <!-- Notification Menu -->
    <mat-menu #notificationMenu="matMenu" class="notification-menu">
      <div class="notification-header">
        <h3>Notifications</h3>
        <button mat-icon-button (click)="markAllAsRead()" *ngIf="(unreadCount$ | async)! > 0">
          <mat-icon>done_all</mat-icon>
        </button>
      </div>
      
      <div class="notification-content">
        @if (isLoadingNotifications) {
          <div class="loading-notifications">
            <mat-spinner diameter="30"></mat-spinner>
            <p>Loading notifications...</p>
          </div>
        } @else if (notifications.length === 0) {
          <div class="no-notifications">
            <mat-icon>notifications_none</mat-icon>
            <p>No notifications yet</p>
          </div>
        } @else {
          <div class="notification-list">
            @for (notification of notifications; track notification.id) {
              <div class="notification-item" 
                   [class.unread]="!notification.isRead"
                   (click)="onNotificationClick(notification)">
                <div class="notification-icon">
                  <mat-icon>play_circle</mat-icon>
                </div>
                <div class="notification-content">
                  <div class="notification-text">
                    <p class="notification-title">{{ notification.videoTitle }}</p>
                    <p class="notification-meta">{{ notification.channelName }} Â· {{ notification.createdAt | date:'short' }}</p>
                  </div>
                  <div class="notification-actions">
                    <button mat-icon-button (click)="$event.stopPropagation(); deleteNotification(notification.id)">
                      <mat-icon>close</mat-icon>
                    </button>
                  </div>
                </div>
              </div>
            }
          </div>
        }
      </div>
    </mat-menu>
  } @else {
    <!-- Guest User -->
    <button mat-button routerLink="/login">Login</button>
    <button mat-button routerLink="/register">Register</button>
  }
</mat-toolbar>

