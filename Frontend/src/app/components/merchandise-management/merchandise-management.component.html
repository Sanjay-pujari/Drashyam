<div class="merchandise-management">
  <div class="header">
    <h1>Merchandise Management</h1>
    <p>Manage your merchandise items and orders</p>
  </div>

  <mat-tab-group>
    <!-- Merchandise Items Tab -->
    <mat-tab label="Merchandise Items">
      <div class="tab-content">
        <!-- Add New Item Form -->
        <mat-card class="form-card">
          <mat-card-header>
            <mat-card-title>Add New Merchandise Item</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <form [formGroup]="merchandiseForm" (ngSubmit)="onSubmitMerchandise()">
              <div class="form-row">
                <mat-form-field appearance="outline">
                  <mat-label>Channel</mat-label>
                  <mat-select formControlName="channelId" required>
                    <mat-option *ngFor="let channel of channels" [value]="channel.id">
                      {{ channel.name }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Name</mat-label>
                  <input matInput formControlName="name" placeholder="Item name" required>
                </mat-form-field>
              </div>

              <div class="form-row">
                <mat-form-field appearance="outline">
                  <mat-label>Category</mat-label>
                  <mat-select formControlName="category" required>
                    <mat-option *ngFor="let category of categories" [value]="category">
                      {{ category }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Price</mat-label>
                  <input matInput type="number" formControlName="price" placeholder="0.00" required>
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Currency</mat-label>
                  <mat-select formControlName="currency" required>
                    <mat-option *ngFor="let currency of currencies" [value]="currency">
                      {{ currency }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>

              <div class="form-row">
                <mat-form-field appearance="outline">
                  <mat-label>Stock Quantity</mat-label>
                  <input matInput type="number" formControlName="stockQuantity" placeholder="0" required>
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Description</mat-label>
                  <textarea matInput formControlName="description" placeholder="Item description" rows="3"></textarea>
                </mat-form-field>
              </div>

              <!-- Sizes -->
              <div class="form-row">
                <mat-form-field appearance="outline">
                  <mat-label>Sizes</mat-label>
                  <mat-chip-grid #chipGrid aria-label="Sizes">
                    <mat-chip-row *ngFor="let size of merchandiseForm.get('sizes')?.value" (removed)="removeSize(size)">
                      {{ size }}
                      <button matChipRemove>
                        <mat-icon>cancel</mat-icon>
                      </button>
                    </mat-chip-row>
                  </mat-chip-grid>
                  <input placeholder="Add size" [matChipInputFor]="chipGrid" [matChipInputSeparatorKeyCodes]="separatorKeysCodes" (matChipInputTokenEnd)="addSize($event)">
                </mat-form-field>
              </div>

              <!-- Colors -->
              <div class="form-row">
                <mat-form-field appearance="outline">
                  <mat-label>Colors</mat-label>
                  <mat-chip-grid #colorGrid aria-label="Colors">
                    <mat-chip-row *ngFor="let color of merchandiseForm.get('colors')?.value" (removed)="removeColor(color)">
                      {{ color }}
                      <button matChipRemove>
                        <mat-icon>cancel</mat-icon>
                      </button>
                    </mat-chip-row>
                  </mat-chip-grid>
                  <input placeholder="Add color" [matChipInputFor]="colorGrid" [matChipInputSeparatorKeyCodes]="separatorKeysCodes" (matChipInputTokenEnd)="addColor($event)">
                </mat-form-field>
              </div>

              <div class="form-row">
                <mat-slide-toggle formControlName="isActive">Active</mat-slide-toggle>
              </div>

              <div class="form-actions">
                <button mat-raised-button color="primary" type="submit" [disabled]="merchandiseForm.invalid">
                  <mat-icon>add</mat-icon>
                  Add Item
                </button>
                <button mat-button type="button" (click)="merchandiseForm.reset()">
                  Reset
                </button>
              </div>
            </form>
          </mat-card-content>
        </mat-card>

        <!-- Merchandise Items List -->
        <mat-card class="list-card">
          <mat-card-header>
            <mat-card-title>Merchandise Items</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div *ngIf="loading" class="loading-spinner">
              <mat-spinner diameter="50"></mat-spinner>
            </div>

            <div *ngIf="!loading && merchandiseItems.length === 0" class="no-data">
              <mat-icon>inventory</mat-icon>
              <p>No merchandise items found</p>
            </div>

            <div *ngIf="!loading && merchandiseItems.length > 0" class="table-container">
              <table mat-table [dataSource]="merchandiseItems" class="merchandise-table">
                <ng-container matColumnDef="name">
                  <th mat-header-cell *matHeaderCellDef>Name</th>
                  <td mat-cell *matCellDef="let item">{{ item.name }}</td>
                </ng-container>

                <ng-container matColumnDef="category">
                  <th mat-header-cell *matHeaderCellDef>Category</th>
                  <td mat-cell *matCellDef="let item">{{ item.category }}</td>
                </ng-container>

                <ng-container matColumnDef="price">
                  <th mat-header-cell *matHeaderCellDef>Price</th>
                  <td mat-cell *matCellDef="let item">{{ formatCurrency(item.price, item.currency) }}</td>
                </ng-container>

                <ng-container matColumnDef="stockQuantity">
                  <th mat-header-cell *matHeaderCellDef>Stock</th>
                  <td mat-cell *matCellDef="let item">{{ item.stockQuantity }}</td>
                </ng-container>

                <ng-container matColumnDef="isActive">
                  <th mat-header-cell *matHeaderCellDef>Active</th>
                  <td mat-cell *matCellDef="let item">
                    <mat-icon [color]="item.isActive ? 'primary' : 'warn'">
                      {{ item.isActive ? 'check_circle' : 'cancel' }}
                    </mat-icon>
                  </td>
                </ng-container>

                <ng-container matColumnDef="createdAt">
                  <th mat-header-cell *matHeaderCellDef>Created</th>
                  <td mat-cell *matCellDef="let item">{{ formatDate(item.createdAt) }}</td>
                </ng-container>

                <ng-container matColumnDef="actions">
                  <th mat-header-cell *matHeaderCellDef>Actions</th>
                  <td mat-cell *matCellDef="let item">
                    <button mat-icon-button color="primary" (click)="editMerchandiseItem(item)">
                      <mat-icon>edit</mat-icon>
                    </button>
                    <button mat-icon-button color="warn" (click)="deleteMerchandiseItem(item.id)">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
              </table>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-tab>

    <!-- Orders Tab -->
    <mat-tab label="Orders">
      <div class="tab-content">
        <mat-card class="list-card">
          <mat-card-header>
            <mat-card-title>Merchandise Orders</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div *ngIf="orders.length === 0" class="no-data">
              <mat-icon>shopping_cart</mat-icon>
              <p>No orders found</p>
            </div>

            <div *ngIf="orders.length > 0" class="table-container">
              <table mat-table [dataSource]="orders" class="orders-table">
                <ng-container matColumnDef="merchandiseName">
                  <th mat-header-cell *matHeaderCellDef>Item</th>
                  <td mat-cell *matCellDef="let order">{{ order.merchandiseName }}</td>
                </ng-container>

                <ng-container matColumnDef="customerName">
                  <th mat-header-cell *matHeaderCellDef>Customer</th>
                  <td mat-cell *matCellDef="let order">{{ order.customerName }}</td>
                </ng-container>

                <ng-container matColumnDef="amount">
                  <th mat-header-cell *matHeaderCellDef>Amount</th>
                  <td mat-cell *matCellDef="let order">{{ formatCurrency(order.amount, order.currency) }}</td>
                </ng-container>

                <ng-container matColumnDef="quantity">
                  <th mat-header-cell *matHeaderCellDef>Quantity</th>
                  <td mat-cell *matCellDef="let order">{{ order.quantity }}</td>
                </ng-container>

                <ng-container matColumnDef="status">
                  <th mat-header-cell *matHeaderCellDef>Status</th>
                  <td mat-cell *matCellDef="let order">
                    <span class="status-badge" [ngClass]="'status-' + getOrderStatusColor(order.status)">
                      {{ getOrderStatusText(order.status) }}
                    </span>
                  </td>
                </ng-container>

                <ng-container matColumnDef="orderedAt">
                  <th mat-header-cell *matHeaderCellDef>Ordered</th>
                  <td mat-cell *matCellDef="let order">{{ formatDate(order.orderedAt) }}</td>
                </ng-container>

                <ng-container matColumnDef="actions">
                  <th mat-header-cell *matHeaderCellDef>Actions</th>
                  <td mat-cell *matCellDef="let order">
                    <button mat-icon-button color="primary" (click)="viewOrder(order)">
                      <mat-icon>visibility</mat-icon>
                    </button>
                    <button mat-icon-button color="accent" (click)="updateOrderStatus(order.id, MerchandiseOrderStatus.Confirmed)">
                      <mat-icon>check</mat-icon>
                    </button>
                    <button mat-icon-button color="primary" (click)="updateOrderStatus(order.id, MerchandiseOrderStatus.Shipped)">
                      <mat-icon>local_shipping</mat-icon>
                    </button>
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="orderColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: orderColumns;"></tr>
              </table>

              <mat-paginator
                [length]="totalCount"
                [pageSize]="pageSize"
                [pageSizeOptions]="[5, 10, 25, 50]"
                (page)="onPageChange($event)">
              </mat-paginator>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-tab>

    <!-- Analytics Tab -->
    <mat-tab label="Analytics">
      <div class="tab-content">
        <div *ngIf="analytics" class="analytics-grid">
          <mat-card class="stat-card">
            <mat-card-content>
              <div class="stat-value">{{ analytics.totalItems }}</div>
              <div class="stat-label">Total Items</div>
            </mat-card-content>
          </mat-card>

          <mat-card class="stat-card">
            <mat-card-content>
              <div class="stat-value">{{ analytics.totalOrders }}</div>
              <div class="stat-label">Total Orders</div>
            </mat-card-content>
          </mat-card>

          <mat-card class="stat-card">
            <mat-card-content>
              <div class="stat-value">{{ formatCurrency(analytics.totalRevenue) }}</div>
              <div class="stat-label">Total Revenue</div>
            </mat-card-content>
          </mat-card>

          <mat-card class="stat-card">
            <mat-card-content>
              <div class="stat-value">{{ formatCurrency(analytics.averageOrderValue) }}</div>
              <div class="stat-label">Average Order Value</div>
            </mat-card-content>
          </mat-card>
        </div>

        <div *ngIf="!analytics" class="loading-spinner">
          <mat-spinner diameter="50"></mat-spinner>
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>
