@if (video) {
  <div class="video-player-container">
    <!-- Video Player -->
    <div class="video-wrapper" style="position: relative;">
      @if (hasError) {
        <div class="video-error">
          <mat-icon>error_outline</mat-icon>
          <h3>Video Error</h3>
          <p>{{ errorMessage }}</p>
          <p class="error-details">Video URL: {{ video.videoUrl }}</p>
        </div>
      } @else {
        <video
          #videoElement
          class="video-js vjs-default-skin"
          controls
          preload="auto"
          data-setup="{}">
          <p class="vjs-no-js">
            To view this video please enable JavaScript, and consider upgrading to a web browser that
            <a href="https://videojs.com/html5-video-support/" target="_blank">
              supports HTML5 video
            </a>.
          </p>
        </video>
      }
      
      <!-- Ad Overlay -->
      <app-video-ad-overlay
        [ad]="currentAd"
        [isVisible]="showAdOverlay"
        (adCompleted)="onAdCompleted()"
        (adSkipped)="onAdSkipped()"
        (adClicked)="onAdClicked()"
        (adClosed)="onAdClosed()">
      </app-video-ad-overlay>
    </div>
    <!-- Video Info -->
    <div class="video-info">
      <h1 class="video-title">{{ video.title }}</h1>
      <!-- Video Stats -->
      <div class="video-stats">
        <div class="stats-item">
          <span class="stat-value">{{ video.viewCount | number }}</span>
          <span class="stat-label">views</span>
        </div>
        <div class="stats-item">
          <span class="stat-value">{{ video.createdAt | date:'MMM d, y' }}</span>
          <span class="stat-label">published</span>
        </div>
      </div>
      <!-- Video Actions -->
      <div class="video-actions">
        @if (currentUser$ | async) {
          <button
            class="action-btn like-btn"
            [class.active]="video.isLiked"
            (click)="likeVideo()"
            >
            <mat-icon>{{ video.isLiked ? 'thumb_up' : 'thumb_up_outline' }}</mat-icon>
            <span>{{ video.likeCount | number }}</span>
          </button>
        }
        @if (currentUser$ | async) {
          <button
            class="action-btn dislike-btn"
            [class.active]="video.isDisliked"
            (click)="dislikeVideo()"
            >
            <mat-icon>{{ video.isDisliked ? 'thumb_down' : 'thumb_down_outline' }}</mat-icon>
            <span>{{ video.dislikeCount | number }}</span>
          </button>
        }
        <button class="action-btn share-btn" (click)="shareVideo()">
          <mat-icon>share</mat-icon>
          <span>Share</span>
        </button>
        <button class="action-btn embed-btn" (click)="embedVideo()">
          <mat-icon>code</mat-icon>
          <span>Embed</span>
        </button>
        <button class="action-btn save-btn" (click)="toggleWatchLater()" [class.active]="isInWatchLater">
          <mat-icon>{{ isInWatchLater ? 'watch_later' : 'watch_later_outlined' }}</mat-icon>
          <span>{{ isInWatchLater ? 'Saved' : 'Watch Later' }}</span>
        </button>
        <button class="action-btn playlist-btn" (click)="saveVideo()">
          <mat-icon>playlist_add</mat-icon>
          <span>Add to Playlist</span>
        </button>
      </div>
    </div>

    <!-- Premium Content Section -->
    @if (isPremiumContent) {
      <div class="premium-content-section">
        <div class="premium-banner">
          <div class="premium-icon">
            <mat-icon>diamond</mat-icon>
          </div>
          <div class="premium-info">
            <h3>Premium Content</h3>
            <p>This video requires a one-time purchase to watch</p>
            <div class="premium-price">
              <span class="price">{{ premiumPrice | currency:premiumCurrency:'symbol':'1.2-2' }}</span>
              <span class="currency">{{ premiumCurrency }}</span>
            </div>
          </div>
        </div>
        
        @if (currentUser$ | async) {
          @if (hasPurchased) {
            <div class="purchased-content">
              <mat-icon>check_circle</mat-icon>
              <span>You have access to this premium content</span>
            </div>
          } @else {
            <div class="purchase-actions">
              <button mat-raised-button color="primary" (click)="purchasePremiumContent()" [disabled]="isPurchasing">
                <mat-icon *ngIf="isPurchasing">hourglass_empty</mat-icon>
                <mat-icon *ngIf="!isPurchasing">shopping_cart</mat-icon>
                {{ isPurchasing ? 'Processing...' : 'Purchase for ' + (premiumPrice | currency:premiumCurrency:'symbol':'1.2-2') }}
              </button>
              <button mat-button (click)="showPremiumDetails()">
                <mat-icon>info</mat-icon>
                Learn More
              </button>
            </div>
          }
        } @else {
          <div class="login-required">
            <p>Please log in to purchase this premium content</p>
            <button mat-raised-button color="primary" routerLink="/login">
              <mat-icon>login</mat-icon>
              Log In
            </button>
          </div>
        }
      </div>
    }

    <!-- Channel Info -->
    @if (video.channel) {
      <div class="channel-info">
        <div class="channel-avatar">
          <img [src]="video.channel.profilePictureUrl || '/assets/default-avatar.svg'"
            [alt]="video.channel.name">
          </div>
          <div class="channel-details">
            <h3 class="channel-name">{{ video.channel.name }}</h3>
            <p class="channel-subscribers">{{ video.channel.subscriberCount | number }} subscribers</p>
          </div>
          <button class="subscribe-btn"
            [class.subscribed]="video.channel.isSubscribed">
            {{ video.channel.isSubscribed ? 'Subscribed' : 'Subscribe' }}
          </button>
        </div>
      }
      <!-- Video Description -->
      @if (video.description) {
        <div class="video-description">
          <div class="description-content">
            <p>{{ video.description }}</p>
          </div>
          @if (video.description.length > 200) {
            <button class="show-more-btn">
              Show more
            </button>
          }
        </div>
      }
      <!-- Comments Section -->
      <app-comments [videoId]="video.id" [commentCount]="video.commentCount"></app-comments>
    </div>
  }

  <!-- Loading State -->
  @if (isLoading) {
    <div class="loading-container">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Loading video...</p>
    </div>
  }

  <!-- Error State -->
  @if (!video && !isLoading) {
    <div class="error-container">
      <mat-icon class="error-icon">error_outline</mat-icon>
      <h3>Video not found</h3>
      <p>The video you're looking for doesn't exist or has been removed.</p>
    </div>
  }